package useragent

import (
	"fmt"
	"testing"

	"github.com/stretchr/testify/assert"
)

func Test_Parses(t *testing.T) {

	var testCases = []struct {
		ua             string
		deviceID       int
		platformID     int
		browserID      int
		browserVersion string
		osID           int
		osVersion      string
		mobile         bool
		bot            bool
	}{ // iphone
		{
			ua:             "Mozilla/5.0 (iPhone; CPU iPhone OS 12_2 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148",
			deviceID:       4,
			platformID:     6,
			browserID:      9,
			browserVersion: "",
			osID:           4,
			osVersion:      "12.2",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (iPhone; CPU iPhone OS 15_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) CriOS/99.0.4844.47 Mobile/15E148 Safari/604.1",
			deviceID:       4,
			platformID:     6,
			browserID:      1,
			browserVersion: "99.0.4844.47",
			osID:           4,
			osVersion:      "15.3",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (iPhone; CPU iPhone OS 12_2_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) FxiOS/97.0 Mobile/15E148 Safari/605.1.15",
			deviceID:       4,
			platformID:     6,
			browserID:      3,
			browserVersion: "97.0",
			osID:           4,
			osVersion:      "12.2.1",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (iPhone; CPU iPhone OS 14_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 OPT/3.1.3",
			deviceID:       4,
			platformID:     6,
			browserID:      6,
			browserVersion: "3.1.3",
			osID:           4,
			osVersion:      "14.6",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (iPhone; CPU iPhone OS 15_3_1 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/15.0 EdgiOS/97.1072.69 Mobile/15E148 Safari/605.1.15",
			deviceID:       4,
			platformID:     6,
			browserID:      8,
			browserVersion: "97.1072.69",
			osID:           4,
			osVersion:      "15.3.1",
			mobile:         true,
			bot:            false,
		},

		{ // ipad
			ua:             "Mozilla/5.0 (iPad; CPU OS 10_3_3 like Mac OS X) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60",
			deviceID:       3,
			platformID:     5,
			browserID:      9,
			browserVersion: "",
			osID:           4,
			osVersion:      "10.3.3",
			mobile:         true,
			bot:            false,
		},
		{ // ipod
			ua:             "Mozilla/5.0 (iPod touch; CPU iPhone OS 9_3_5 like Mac OS X) AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13G36 Safari/601.1",
			deviceID:       3,
			platformID:     7,
			browserID:      3,
			browserVersion: "9.0",
			osID:           4,
			osVersion:      "9.3.5",
			mobile:         true,
			bot:            false,
		},
		{ // mac os
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Safari/605.1.15",
			deviceID:       2,
			platformID:     4,
			browserID:      3,
			browserVersion: "14.0.3",
			osID:           3,
			osVersion:      "10.15.6",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_2_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36",
			deviceID:       2,
			platformID:     4,
			browserID:      1,
			browserVersion: "99.0.4844.51",
			osID:           3,
			osVersion:      "12.2.1",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 12.2; rv:97.0) Gecko/20100101 Firefox/97.0",
			deviceID:       2,
			platformID:     4,
			browserID:      3,
			browserVersion: "97.0",
			osID:           3,
			osVersion:      "12.2",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_2_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Vivaldi/4.3",
			deviceID:       2,
			platformID:     4,
			browserID:      7,
			browserVersion: "4.3",
			osID:           3,
			osVersion:      "12.2.1",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 12_2_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Edg/97.0.1072.69",
			deviceID:       2,
			platformID:     4,
			browserID:      8,
			browserVersion: "97.0.1072.69",
			osID:           3,
			osVersion:      "12.2.1",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Brave Chrome/83.0.4103.116 Safari/537.36",
			deviceID:       2,
			platformID:     4,
			browserID:      10,
			browserVersion: "",
			osID:           3,
			osVersion:      "10.15.5",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_6_8) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/38.0.2125.122 Safari/537.36 OPR/25.0.1614.71",
			deviceID:       2,
			platformID:     4,
			browserID:      6,
			browserVersion: "25.0.1614.71",
			osID:           3,
			osVersion:      "10.6.8",
			mobile:         false,
			bot:            false,
		},

		{ // linux
			ua:             "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "99.0.4844.51",
			osID:           2,
			osVersion:      "",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 OPR/84.0.4316.21",
			deviceID:       2,
			platformID:     2,
			browserID:      6,
			browserVersion: "84.0.4316.21",
			osID:           2,
			osVersion:      "",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; Linux i686; rv:97.0) Gecko/20100101 Firefox/97.0",
			deviceID:       2,
			platformID:     2,
			browserID:      3,
			browserVersion: "97.0",
			osID:           2,
			osVersion:      "",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Vivaldi/4.3",
			deviceID:       2,
			platformID:     2,
			browserID:      7,
			browserVersion: "4.3",
			osID:           2,
			osVersion:      "",
			mobile:         false,
			bot:            false,
		},

		{ // windows nt
			ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/98.0.4758.102 Safari/537.36",
			deviceID:       2,
			platformID:     3,
			browserID:      1,
			browserVersion: "98.0.4758.102",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Edg/99.0.1150.30",
			deviceID:       2,
			platformID:     3,
			browserID:      8,
			browserVersion: "99.0.1150.30",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36 Edge/18.17763",
			deviceID:       2,
			platformID:     3,
			browserID:      8,
			browserVersion: "18.17763",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 OPR/84.0.4316.21",
			deviceID:       2,
			platformID:     3,
			browserID:      6,
			browserVersion: "84.0.4316.21",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Vivaldi/4.3",
			deviceID:       2,
			platformID:     3,
			browserID:      7,
			browserVersion: "4.3",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Brave Chrome/83.0.4103.116 Safari/537.36",
			deviceID:       2,
			platformID:     3,
			browserID:      10,
			browserVersion: "",
			osID:           6,
			osVersion:      "10.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/4.0 (compatible; MSIE 9.0; Windows NT 6.1; 125LA; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)",
			deviceID:       2,
			platformID:     3,
			browserID:      2,
			browserVersion: "9.0",
			osID:           6,
			osVersion:      "6.1",
			mobile:         false,
			bot:            false,
		},

		{ // android
			ua:             "Mozilla/5.0 (Linux; Android 10) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.48 Mobile Safari/537.36",
			deviceID:       4,
			platformID:     2,
			browserID:      1,
			browserVersion: "99.0.4844.48",
			osID:           7,
			osVersion:      "10",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Android 12; Mobile; rv:68.0) Gecko/68.0 Firefox/97.0",
			deviceID:       4,
			platformID:     2,
			browserID:      3,
			browserVersion: "97.0",
			osID:           7,
			osVersion:      "12",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Linux; Android 10; VOG-L29) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.48 Mobile Safari/537.36 OPR/63.3.3216.58675",
			deviceID:       4,
			platformID:     2,
			browserID:      6,
			browserVersion: "63.3.3216.58675",
			osID:           7,
			osVersion:      "10",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Linux; Android 10; PCT-AL10 Build/HUAWEIPCT-AL10) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.106 Mobile Safari/537.36 OPT/2.8",
			deviceID:       4,
			platformID:     2,
			browserID:      6,
			browserVersion: "2.8",
			osID:           7,
			osVersion:      "10",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (Linux; Android 10; HD1913) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.48 Mobile Safari/537.36 EdgA/97.0.1072.69",
			deviceID:       4,
			platformID:     2,
			browserID:      8,
			browserVersion: "97.0.1072.69",
			osID:           7,
			osVersion:      "10",
			mobile:         true,
			bot:            false,
		},

		{
			ua:             "Mozilla/5.0 (Linux; Android 11; SM-N975F) AppleWebKit/537.36 (KHTML, like Gecko) Brave Chrome/89.0.4389.105 Mobile Safari/537.36",
			deviceID:       4,
			platformID:     2,
			browserID:      10,
			browserVersion: "",
			osID:           7,
			osVersion:      "11",
			mobile:         true,
			bot:            false,
		},

		// { // windows mobile
		// 	ua:             "Mozilla/5.0 (Windows Mobile 10; Android 10.0; Microsoft; Lumia 950XL) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Mobile Safari/537.36 Edge/40.15254.603",
		// 	deviceID:       4,
		// 	platformID:     2,
		// 	browserID:      8,
		// 	browserVersion: "40.15254.603",
		// 	osID:           7,
		// 	osVersion:      "10",
		// 	mobile:         true,
		// 	bot:            false,
		// },
		// { // xbox
		// 	ua:             "Mozilla/5.0 (Windows NT 10.0; Win64; x64; Xbox; Xbox One) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/99.0.4844.51 Safari/537.36 Edge/44.18363.8131",
		// 	deviceID:       4,
		// 	platformID:     2,
		// 	browserID:      8,
		// 	browserVersion: "40.15254.603",
		// 	osID:           7,
		// 	osVersion:      "10",
		// 	mobile:         true,
		// 	bot:            false,
		// },

		{ // ChromeOS
			ua:             "Mozilla/5.0 (X11; CrOS armv7l 12105.100.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/12105.100.0 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "12105.100.0",
			osID:           9,
			osVersion:      "12105.100.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; CrOS x86_64 13904.97.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.167 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "91.0.4472.167",
			osID:           9,
			osVersion:      "13904.97.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; CrOS aarch64 14268.67.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.111 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "96.0.4664.111",
			osID:           9,
			osVersion:      "14268.67.0",
			mobile:         false,
			bot:            false,
		},

		{
			ua:             "Mozilla/5.0 (X11; CrOS armv6l 13597.84.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.78 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "95.0.4638.78",
			osID:           9,
			osVersion:      "13597.84.0",
			mobile:         false,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (X11; CrOS i686 9334.72.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.140 Safari/537.36",
			deviceID:       2,
			platformID:     2,
			browserID:      1,
			browserVersion: "58.0.3029.140",
			osID:           9,
			osVersion:      "9334.72.0",
			mobile:         false,
			bot:            false,
		},

		// blackberry
		{
			ua:             "Mozilla/5.0 (BlackBerry; U; BlackBerry 9780; en) AppleWebKit/534.8+ (KHTML, like Gecko) Version/6.0.0.570 Mobile Safari/534.8+",
			deviceID:       4,
			platformID:     8,
			browserID:      11,
			browserVersion: "6.0.0.570",
			osID:           8,
			osVersion:      "",
			mobile:         true,
			bot:            false,
		},
		{
			ua:             "Mozilla/5.0 (BB10; Kbd) AppleWebKit/537.35+ (KHTML, like Gecko) Version/10.3.2.2876 Mobile Safari/537.35+",
			deviceID:       4,
			platformID:     8,
			browserID:      11,
			browserVersion: "10.3.2.2876",
			osID:           8,
			osVersion:      "",
			mobile:         true,
			bot:            false,
		},
	}

	for _, testCase := range testCases {
		ua := Parse(testCase.ua)
		fmt.Println(ua)
		assert.Equal(t, testCase.deviceID, ua.Device().ID())
		assert.Equal(t, Devices[testCase.deviceID], ua.Device().String())
		assert.Equal(t, testCase.platformID, ua.Platform().ID())
		assert.Equal(t, Platforms[testCase.platformID], ua.Platform().String())
		assert.Equal(t, testCase.browserID, ua.Browser().ID())
		assert.Equal(t, Browsers[testCase.browserID], ua.Browser().String())
		assert.Equal(t, testCase.browserVersion, ua.Browser().Version())
		assert.Equal(t, testCase.osID, ua.OS().ID())
		assert.Equal(t, OSs[testCase.osID], ua.OS().String())
		assert.Equal(t, testCase.osVersion, ua.OS().Version())
		assert.Equal(t, testCase.mobile, ua.Mobile())
		assert.Equal(t, testCase.bot, ua.Bot())

	}

}
